local lib = loadstring(game:HttpGet("https://raw.githubusercontent.com/SpineZik/spsps/refs/heads/main/MiniUILibrary"))()
local jsons = game:GetService("HttpService")
local settings = {
	CoinsFarmEnabled = false, 
	BallsFarmEnabled = false,
	CandyFarmEnabled = false,
	Farming = false,
	Webhook = "",
	Speed = 1.15,
	PlayerDiedInRound = false,
	CoinBeingCollected = false,
	FullCoins = false,
	CoinsCollected = 0,
	CoinsContainer = nil,
	StartTick = tick(),
	SafePosition = CFrame.new(-5073.67773, 284.78653, 70.5502548, -0.903661311, 3.13552606e-09, -0.428247869, 1.62285101e-08, 1, -2.69226117e-08, 0.428247869, -3.12787449e-08, -0.903661311),
	ExceptCoins = {},
	CoinFound = function(self, coin)
		if coin == nil then return true end
		for _, searchable_coin in pairs(self['ExceptCoins']) do
			if searchable_coin == coin then
				return true
			end
		end
		return false
	end
} 
settings['CalculateMinimumCoin'] = function(self, hrp)
	if hrp == nil then return end
	local formatted = {Magnitude = 9e9, Coin = nil}
	for _, coin in self['CoinsContainer']:GetChildren() do
		if self:CoinFound(coin) then continue end
		local pos_ = Vector3.new(0, 0, 0);
		for __, desc_c in coin:GetDescendants() do
			if desc_c:IsA("MeshPart") or desc_c:IsA("UnionOperation") or desc_c:IsA("Part") then
				pos_ = desc_c.Position
			end
		end

		if (hrp.Position - pos_).Magnitude < formatted['Magnitude'] then
			formatted['Magnitude'] = (hrp.Position - pos_).Magnitude
			formatted['Coin'] = coin
		end
	end
	return formatted
end
local function send_discord_message(embed)
	task.spawn(function()
		local json_data = {
			content = "",
			embeds = {embed}
		}

		local request_options = {
			Url = tostring(settings['Webhook']),
			Method = "POST",
			Headers = {
				["Content-Type"] = "application/json"
			},
			Body = game:GetService("HttpService"):JSONEncode(json_data)
		}
		local response = request(request_options)
	end)
end


task.spawn(function()
	-- file sys
	local main_folder = isfolder('SpineWare')
	local d_folder = isfolder('SpineWare/MM2Farmer')
	local p_f = isfile('SpineWare/MM2Farmer/settings.json')
	if not main_folder then
		makefolder('SpineWare')
	end
	if not d_folder then
		makefolder('SpineWare/MM2Farmer')
	end
	if not p_f then
		writefile('SpineWare/MM2Farmer/settings.json', jsons:JSONEncode({
			Farming = false,
			CoinsFarmEnabled = false, 
			BallsFarmEnabled = false,
			CandyFarmEnabled = false,
			Speed = 1.15,
			Webhook = "",
			ReadIt = "HEY! The speed is very sensitive! Change it slowly. Recommended speed: 1.5"
		}))
	end
	local user_settings = jsons:JSONDecode(readfile('SpineWare/MM2Farmer/settings.json'))
	settings['Farming'] = user_settings['Farming']
	settings['CoinsFarmEnabled'] = user_settings['CoinsFarmEnabled']
	settings['BallsFarmEnabled'] = user_settings['BallsFarmEnabled']
	settings['CandyFarmEnabled'] = user_settings['CandyFarmEnabled']
	settings['Webhook'] = user_settings['Webhook']
	settings['Speed'] = user_settings['Speed']
end)

local player = game:GetService("Players")['LocalPlayer']
local character = player['Character'] or player['CharacterAdded']:Wait()
local ts = game:GetService("TweenService")

player['CharacterAdded']:Connect(function(character_)
	task.spawn(function()
		character = character_
		local humanoid = character:FindFirstChildOfClass("Humanoid") or character:WaitForChild("Humanoid", 1/0)
		humanoid['Died']:Once(function()
			settings['PlayerDiedInRound'] = true
			character = player['Character'] or player['CharacterAdded']:Wait()
		end)
	end)
end)

local controller = lib:Init(game['CoreGui'], "SpineWare")
local autofarm_state = controller:CreateToggle({
	Name = "Farming",
	Signal = function(status)
		settings['Farming'] = status
	end,
	FirstValue = settings['Farming']
})
local speed_checkbox = controller:CreateTextBox({
	Text = "Speed [sensitive]",
	Signal = function(new_speed)
		if tonumber(new_speed) ~= nil then
			settings['Speed'] = new_speed
		end
	end
})
local webhook_checkbox = controller:CreateTextBox({
	Text = "Webhook",
	Signal = function(webhook)
		if webhook:match('discord') then
			settings['Webhook'] = webhook
		end
	end
})

task.spawn(function()
	for _, d in workspace:GetDescendants() do
		if d.Name == "CoinContainer" then
			settings['CoinsContainer'] = d
			d.Destroying:Once(function()
				settings['CoinsContainer'] = nil
				table.clear(settings['ExceptCoins'])
			end)
		end
	end
end)

local function gettime(s)
	s = math.floor(math.abs(s))
	return string.format("%02d:%02d:%02d", math.floor(s/3600), math.floor((s%3600)/60), s%60)
end

workspace['DescendantAdded']:Connect(function(d)
	task.spawn(function()
		if d.Name == "CoinContainer" then
			settings['CoinsContainer'] = d
			task.spawn(function()
				local coins = 'NaN'
				for _, var in game['Players']['LocalPlayer']['PlayerGui']:GetDescendants() do
					local var_name = var:GetFullName()
					if var:IsA("TextLabel") and var_name:match('Tokens') and var_name:match("Container") and var.Text ~= '0' then
						coins = var.Text
						print(var.Text)
						break
					end
				end
				send_discord_message({title = string.format("SpineWare >>> [%s]", game['Players']['LocalPlayer']['Name']), description = string.format("âŒ› Round has been finished\nâ¬† Uptime: %s\nðŸ’° Coins Per Hour: %d\nðŸ’² Balance: %s\n\n[Inaccurate Data]", gettime(math.floor(tick() - settings['StartTick'])), math.floor(settings['CoinsCollected']/math.floor(tick() - settings['StartTick'])), coins), color = 16711680, thumbnail = {url = "https://github.com/SpineWare/UniversalLoader/blob/main/photo_2026-01-10_16-39-43.jpg?raw=true"}})
			end)
			settings['PlayerDiedInRound'] = false
			settings['FullCoins'] = false
			d.Destroying:Once(function()
				settings['CoinsContainer'] = nil
				table.clear(settings['ExceptCoins'])
			end)
		end
	end)
end)

task.spawn(function()
	while task.wait() do
		if settings['Farming'] then
			if character ~= nil and settings['CoinsContainer'] ~= nil and not settings['PlayerDiedInRound'] and not settings['CoinBeingCollected'] then
				local coin_data = settings:CalculateMinimumCoin(character:FindFirstChild("HumanoidRootPart"))
				if coin_data ~= nil then
					local distance = coin_data['Magnitude']
					local coin = coin_data['Coin']

					pcall(function()
						for _, part in character:GetChildren() do
							if part:IsA("BasePart") or part:IsA("MeshPart") then
								part.CanCollide = false
							end
						end
					end)

					if coin ~= nil then
						local code_can_be_proceed = true
						if not coin:FindFirstChild("CoinVisual") then
							if character:FindFirstChild('Head') then
								character:FindFirstChild("Head"):Destroy()
							end
							settings['FullCoins'] = true
							task.wait(.1)
							code_can_be_proceed = false
						end
						if code_can_be_proceed then 
							if distance <= 180 then
								local speed_of_tween = (distance/16)/settings['Speed']
								settings['CoinBeingCollected'] = true

								task.delay(speed_of_tween - 0.2, function()
									pcall(function()
										firetouchintererst(character:FindFirstChild("HumanoidRootPart"), coin, 0)
										task.wait()
										firetouchintererst(character:FindFirstChild("HumanoidRootPart"), coin, 1)
									end)
								end)
								pcall(function()
									ts:Create(character:FindFirstChild("HumanoidRootPart"), TweenInfo.new(speed_of_tween, Enum.EasingStyle.Linear), {CFrame = coin:GetPivot()}):Play()
									task.wait(speed_of_tween - 0.05)
									settings['CoinsCollected'] += 1 
									coin:Destroy()
								end)
								settings['CoinBeingCollected'] = false
							else
								pcall(function()
									character:FindFirstChild("HumanoidRootPart").CFrame = coin:GetPivot()
								end)
							end
						end
					end
				end
			else
				task.wait(.6)
				if character then
					pcall(function()
						character:FindFirstChild("HumanoidRootPart").CFrame = settings['SafePosition']
					end)
				else
					print("No char")
				end
				warn("No Character/No Coin Container/Player has already died in round")
			end
		end
	end
end)

--reconnect logic
game:GetService("GuiService").ErrorMessageChanged:Connect(function()
	task.spawn(function()
		writefile('SpineWare/MM2Farmer/settings.json', jsons:JSONEncode({
			Farming = settings['Farming'],
			CoinsFarmEnabled = false, 
			BallsFarmEnabled = false,
			CandyFarmEnabled = false,
			Speed = settings['Speed'],
			Webhook = settings['Webhook'],
			ReadIt = "HEY! The speed is very sensitive! Change it slowly. Recommended speed: 1.5"
		}))
	end)

	local servers = {}
	local req = game:HttpGet("https://games.roblox.com/v1/games/" .. game['PlaceId'] .. "/servers/Public?cursor=&sortOrder=Asc&limit=100&excludeFullGames=false")
	local body = jsons:JSONDecode(req)

	if body and body.data then
		for i, v in next, body.data do
			if type(v) == "table" and tonumber(v.playing) and tonumber(v.maxPlayers) and v.playing < v.maxPlayers and v.id ~= game['JobId'] then
				table.insert(servers, v)
			end
		end
	end
	local choosedserver = {Players = 0, Server = nil}
	for _, server in servers do
		if server['playing'] > choosedserver['Players'] then
			choosedserver['Players'] = server['playing']
			choosedserver['Server'] = server['id']
		end
	end
	if #servers > 0 then
		game:GetService("TeleportService"):TeleportToPlaceInstance(game['PlaceId'], choosedserver['Server'], game['Players']['LocalPlayer'])
	end
end)
queue_on_teleport("loadstring(game:HttpGet('https://raw.githubusercontent.com/Rootif-prog/fantastic-doodle/refs/heads/main/FarmerMystery'))()")


lib:Start()
